class CanvasHelper{static setupHighDPI(canvas,ctx=null,options={}){const{ctx:resolvedCtx,dpr:dpr,displayWidth:displayWidth,displayHeight:displayHeight}=this.setupCanvas(canvas,{ctx:ctx,...options});return{ctx:resolvedCtx,dpr:dpr,displayWidth:displayWidth,displayHeight:displayHeight}}static setupCanvas(canvas,options={}){if(!canvas)throw new Error("CanvasHelper.setupCanvas requires a valid canvas element");const{ctx:providedCtx=null,displayWidth:forcedWidth,displayHeight:forcedHeight,dpr:forcedDpr,applyStyle:applyStyle=!0,enableSmoothing:enableSmoothing=!0,scaleContext:scaleContext=!0,resizeCanvas:resizeCanvas=!0}=options,root="undefined"!=typeof window?window:globalThis,dpr=forcedDpr||root.devicePixelRatio||1,rect="function"==typeof canvas.getBoundingClientRect?canvas.getBoundingClientRect():{width:canvas.clientWidth,height:canvas.clientHeight};let width="number"==typeof forcedWidth?forcedWidth:rect.width||canvas.clientWidth||canvas.width,height="number"==typeof forcedHeight?forcedHeight:rect.height||canvas.clientHeight||canvas.height;if(!width||!height){const computed=root.getComputedStyle?root.getComputedStyle(canvas):null;!width&&computed&&computed.width&&(width=parseFloat(computed.width)),!height&&computed&&computed.height&&(height=parseFloat(computed.height))}if(width=width||canvas.width||0,height=height||canvas.height||0,0===width||0===height)return{ctx:providedCtx,dpr:dpr,displayWidth:width,displayHeight:height};resizeCanvas&&(canvas.width=Math.round(width*dpr),canvas.height=Math.round(height*dpr)),applyStyle&&(canvas.style.width=width+"px",canvas.style.height=height+"px");const ctx=providedCtx||canvas.getContext("2d");return ctx&&scaleContext&&("function"==typeof ctx.setTransform&&ctx.setTransform(1,0,0,1,0,0),ctx.scale(dpr,dpr),enableSmoothing&&"imageSmoothingEnabled"in ctx&&(ctx.imageSmoothingEnabled=!0,"imageSmoothingQuality"in ctx&&(ctx.imageSmoothingQuality="high"))),{ctx:ctx,dpr:dpr,displayWidth:width,displayHeight:height}}static setupOverlay(overlayCanvas,chartCanvas){const dpr=window.devicePixelRatio||1,displayWidth=chartCanvas.clientWidth,displayHeight=chartCanvas.clientHeight;overlayCanvas.width=displayWidth*dpr,overlayCanvas.height=displayHeight*dpr,overlayCanvas.style.width=displayWidth+"px",overlayCanvas.style.height=displayHeight+"px";const ctx=overlayCanvas.getContext("2d");return ctx.scale(dpr,dpr),ctx.imageSmoothingEnabled=!0,ctx.imageSmoothingQuality="high",ctx.clearRect(0,0,displayWidth,displayHeight),{ctx:ctx,dpr:dpr,displayWidth:displayWidth,displayHeight:displayHeight}}static clear(canvas,ctx){const displayWidth=canvas.clientWidth,displayHeight=canvas.clientHeight;ctx.clearRect(0,0,displayWidth,displayHeight)}static dataToPixel(chart,dataX,dataY){const xScale=chart.scales.x,yScale=chart.scales.y;return{x:xScale.getPixelForValue(dataX),y:yScale.getPixelForValue(dataY)}}static pixelToData(chart,pixelX,pixelY){const xScale=chart.scales.x,yScale=chart.scales.y;return{x:xScale.getValueForPixel(pixelX),y:yScale.getValueForPixel(pixelY)}}static drawErrorSquares(ctx,chart,dataPoints,predictFn,options={}){const opts={fillColor:"rgba(231, 76, 60, 0.15)",strokeColor:"rgba(231, 76, 60, 0.4)",lineWidth:1,...options};ctx.fillStyle=opts.fillColor,ctx.strokeStyle=opts.strokeColor,ctx.lineWidth=opts.lineWidth;for(const point of dataPoints){const predicted=predictFn(point.x),error=Math.abs(point.y-predicted),p1=this.dataToPixel(chart,point.x,point.y),p2=this.dataToPixel(chart,point.x+error,point.y),p4=(this.dataToPixel(chart,point.x+error,predicted),this.dataToPixel(chart,point.x,predicted)),width=Math.abs(p2.x-p1.x),height=Math.abs(p4.y-p1.y);ctx.fillRect(p1.x,Math.min(p1.y,p4.y),width,height),ctx.strokeRect(p1.x,Math.min(p1.y,p4.y),width,height)}}}