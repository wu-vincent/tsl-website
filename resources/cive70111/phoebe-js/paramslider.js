class ParamSlider{constructor(elementId,options={}){this.containerElementId=elementId;const containerElement=document.getElementById(elementId);if(!containerElement)return void console.warn(`ParamSlider: Element with id '${elementId}' not found`);const isLegacyPattern="INPUT"===containerElement.tagName&&"range"===containerElement.type;if(isLegacyPattern)this.element=containerElement,this.elementId=elementId;else{if(!options.inputId)return void console.error(`ParamSlider: inputId option is required when using container element (id: ${elementId})`);this.elementId=options.inputId,this.element=document.createElement("input"),this.element.type="range",this.element.id=this.elementId,this.containerElement=containerElement}if(this.element){if(this.scale=options.scale||"linear",isLegacyPattern&&void 0===options.min&&this.element.min?this.min=parseFloat(this.element.min):this.min=void 0!==options.min?options.min:0,isLegacyPattern&&void 0===options.max&&this.element.max?this.max=parseFloat(this.element.max):this.max=void 0!==options.max?options.max:100,isLegacyPattern&&void 0===options.step&&this.element.step?this.step=parseFloat(this.element.step):this.step=void 0!==options.step?options.step:1,"log"===this.scale&&(this._includesZero=0===this.min,this._includesZero?(this._logScaleMin=1e-7,this.logMin=Math.log10(this._logScaleMin)):(this.min<=0&&(console.warn("ParamSlider: Logarithmic scale requires min > 0. Using 0.000001."),this.min=1e-6),this.logMin=Math.log10(this.min)),this.logMax=Math.log10(this.max),this._includesZero?(this._internalMin=0,this._internalMax=100,this._internalStep=1,this._logStartPosition=1):(this._internalMin=0,this._internalMax=100,this._internalStep=1)),void 0!==options.decimals?this.decimals=options.decimals:"log"===this.scale?this.decimals=null:this.decimals=this._detectDecimals(this.step),this.options={label:options.label,fineTuneStep:options.fineTuneStep,onChange:options.onChange,onCommit:options.onCommit,formatValue:options.formatValue,prefix:options.prefix||"",suffix:options.suffix||"",debounceMs:options.debounceMs||0,mathJax:options.mathJax||"auto",disabled:options.disabled||!1,ariaLabel:options.ariaLabel,ariaValueText:options.ariaValueText,valueDisplayId:options.valueDisplayId||`${this.elementId}-value`,plusButtonId:options.plusButtonId||`${this.elementId}-plus`,minusButtonId:options.minusButtonId||`${this.elementId}-minus`},"log"===this.scale)if(this.element.min=this._internalMin,this.element.max=this._internalMax,this.element.step=this._internalStep,void 0!==options.value)this.element.value=this._valueToInternal(options.value);else{const midLog=(this.logMin+this.logMax)/2;this.element.value=this._valueToInternal(Math.pow(10,midLog))}else this.element.min=this.min,this.element.max=this.max,this.element.step=this.step,void 0!==options.value&&(this.element.value=options.value);this._debounceTimeout=null,this._initializeDOM(),this._setupEventListeners(),this.options.disabled&&this.disable(),this._updateValueDisplay(),this._renderMathJax()}else console.warn("ParamSlider: Failed to initialize slider element")}_detectDecimals(step){if("any"===step)return 2;const stepStr=step.toString(),decimalIndex=stepStr.indexOf(".");return-1===decimalIndex?0:stepStr.length-decimalIndex-1}_valueToInternal(value){if("log"===this.scale){if(this._includesZero){if(0===value)return this._internalMin;const normalized=(Math.log10(value)-this.logMin)/(this.logMax-this.logMin);return this._logStartPosition+normalized*(this._internalMax-this._logStartPosition)}{const normalized=(Math.log10(value)-this.logMin)/(this.logMax-this.logMin);return this._internalMin+normalized*(this._internalMax-this._internalMin)}}return value}_internalToValue(internalValue){if("log"===this.scale){if(this._includesZero){if(internalValue===this._internalMin)return 0;const normalized=(internalValue-this._logStartPosition)/(this._internalMax-this._logStartPosition),logValue=this.logMin+normalized*(this.logMax-this.logMin);return Math.pow(10,logValue)}{const normalized=(internalValue-this._internalMin)/(this._internalMax-this._internalMin),logValue=this.logMin+normalized*(this.logMax-this.logMin);return Math.pow(10,logValue)}}return internalValue}_formatValueForDisplay(value){if(this.options.formatValue)return this.options.formatValue(value);if(0===value)return`${this.options.prefix}0.0${this.options.suffix}`;let decimals=this.decimals;"log"===this.scale&&null===decimals&&(decimals=value<1e-4?7:value<.001?6:value<.01?5:value<.1?4:value<1?3:2);const formattedValue=value.toFixed(decimals);return`${this.options.prefix}${formattedValue}${this.options.suffix}`}_initializeDOM(){if(this.containerElement)this.containerElement.className="control-group",this.container=this.containerElement;else{let container=this.element.closest(".control-group");container||(container=document.createElement("div"),container.className="control-group",container.id=`${this.elementId}-control`,this.element.parentNode.insertBefore(container,this.element),container.appendChild(this.element)),this.container=container}this._initializeLabel(),this._initializeSliderContainer(),this._initializeValueDisplay(),this.options.fineTuneStep&&this._initializeFineTuneButtons()}_initializeLabel(){let label=this.container.querySelector(`label[for="${this.elementId}"]`);!label&&this.options.label?(label=document.createElement("label"),label.htmlFor=this.elementId,label.innerHTML=this.options.label,this.container.insertBefore(label,this.container.firstChild)):label&&this.options.label&&(label.innerHTML=this.options.label),this.labelElement=label}_initializeSliderContainer(){let sliderContainer=this.element.closest(".slider-container");sliderContainer||(sliderContainer=document.createElement("div"),sliderContainer.className="slider-container",this.element.parentNode?(this.element.parentNode.insertBefore(sliderContainer,this.element),sliderContainer.appendChild(this.element)):(this.container.appendChild(sliderContainer),sliderContainer.appendChild(this.element))),this.sliderContainer=sliderContainer}_initializeValueDisplay(){let valueDisplay=document.getElementById(this.options.valueDisplayId);valueDisplay||(valueDisplay=document.createElement("div"),valueDisplay.className="value-display",valueDisplay.id=this.options.valueDisplayId,this.sliderContainer.appendChild(valueDisplay)),this.valueDisplayElement=valueDisplay}_initializeFineTuneButtons(){let labelWithButtons=this.container.querySelector(".label-with-buttons");!labelWithButtons&&this.labelElement&&(labelWithButtons=document.createElement("div"),labelWithButtons.className="label-with-buttons",this.labelElement.parentNode.insertBefore(labelWithButtons,this.labelElement),labelWithButtons.appendChild(this.labelElement));let buttonsContainer=this.container.querySelector(".fine-tune-buttons");buttonsContainer||(buttonsContainer=document.createElement("div"),buttonsContainer.className="fine-tune-buttons",labelWithButtons&&labelWithButtons.appendChild(buttonsContainer));let minusButton=document.getElementById(this.options.minusButtonId);minusButton||(minusButton=document.createElement("button"),minusButton.className="fine-tune-btn",minusButton.id=this.options.minusButtonId,minusButton.innerHTML="âˆ’",minusButton.type="button",minusButton.setAttribute("aria-label","Decrease value"),buttonsContainer.appendChild(minusButton));let plusButton=document.getElementById(this.options.plusButtonId);plusButton||(plusButton=document.createElement("button"),plusButton.className="fine-tune-btn",plusButton.id=this.options.plusButtonId,plusButton.innerHTML="+",plusButton.type="button",plusButton.setAttribute("aria-label","Increase value"),buttonsContainer.appendChild(plusButton)),this.minusButton=minusButton,this.plusButton=plusButton}_setupEventListeners(){this.element.addEventListener("input",()=>{this._updateValueDisplay(),this._triggerOnChange()}),this.element.addEventListener("change",()=>{this.options.onCommit&&this.options.onCommit(this.value)}),this.minusButton&&this.minusButton.addEventListener("click",()=>{this._adjustValue(-this.options.fineTuneStep)}),this.plusButton&&this.plusButton.addEventListener("click",()=>{this._adjustValue(this.options.fineTuneStep)})}_updateValueDisplay(){const internalValue=parseFloat(this.element.value),actualValue=this._internalToValue(internalValue),displayValue=this._formatValueForDisplay(actualValue);this.valueDisplayElement.textContent=displayValue,this.options.ariaValueText&&this.element.setAttribute("aria-valuetext",this.options.ariaValueText(actualValue))}_triggerOnChange(){this.options.onChange&&(this.options.debounceMs>0?(this._debounceTimeout&&clearTimeout(this._debounceTimeout),this._debounceTimeout=setTimeout(()=>{this.options.onChange(this.value)},this.options.debounceMs)):this.options.onChange(this.value))}_adjustValue(delta){if("log"===this.scale){const currentActualValue=this.value;let newValue;if(0===currentActualValue)newValue=delta>0?this._includesZero?this._logScaleMin:this.min:0;else{newValue=currentActualValue*(delta>0?3:1/3),this._includesZero&&newValue<this._logScaleMin&&(newValue=0)}newValue=Math.max(this.min,Math.min(this.max,newValue));const internalValue=this._valueToInternal(newValue);this.element.value=internalValue,this._updateValueDisplay(),this._triggerOnChange(),this.options.onCommit&&this.options.onCommit(newValue)}else{let newInternalValue=parseFloat(this.element.value)+delta;newInternalValue=this._snapToStep(newInternalValue),newInternalValue=Math.max(this.min,Math.min(this.max,newInternalValue)),this.element.value=newInternalValue,this._updateValueDisplay(),this._triggerOnChange(),this.options.onCommit&&this.options.onCommit(newInternalValue)}}_snapToStep(value){if("any"===this.step)return value;const steps=Math.round((value-this.min)/this.step);return this.min+steps*this.step}_renderMathJax(){if(!this.labelElement)return;("on"===this.options.mathJax||"auto"===this.options.mathJax&&this.labelElement.innerHTML.includes("$"))&&window.MathJax&&window.MathJax.typesetPromise&&MathJax.typesetPromise([this.labelElement]).catch(err=>console.log("MathJax error:",err))}get value(){const internalValue=parseFloat(this.element.value);return this._internalToValue(internalValue)}getValue(){return this.value}setValue(value,options={}){const{silent:silent=!1,commit:commit=!1}=options;value=Math.max(this.min,Math.min(this.max,value)),"linear"===this.scale&&(value=this._snapToStep(value));const internalValue=this._valueToInternal(value);this.element.value=internalValue,this._updateValueDisplay(),silent||this._triggerOnChange(),commit&&this.options.onCommit&&this.options.onCommit(value)}update(value,options){this.setValue(value,options)}setConfig(config){void 0!==config.min&&(this.min=config.min,"linear"===this.scale&&(this.element.min=config.min)),void 0!==config.max&&(this.max=config.max,"linear"===this.scale&&(this.element.max=config.max)),void 0!==config.step&&(this.step=config.step,"linear"===this.scale&&(this.element.step=config.step)),void 0!==config.decimals&&(this.decimals=config.decimals),"log"!==this.scale||void 0===config.min&&void 0===config.max||(this.logMin=Math.log10(this.min),this.logMax=Math.log10(this.max));const currentValue=this.value;this.setValue(currentValue,{silent:!0})}enable(){this.element.disabled=!1,this.minusButton&&(this.minusButton.disabled=!1),this.plusButton&&(this.plusButton.disabled=!1)}disable(){this.element.disabled=!0,this.minusButton&&(this.minusButton.disabled=!0),this.plusButton&&(this.plusButton.disabled=!0)}destroy(){this._debounceTimeout&&clearTimeout(this._debounceTimeout),this.element.removeEventListener("input",this._updateValueDisplay),this.element.removeEventListener("change",this._triggerOnChange),this.minusButton&&this.minusButton.removeEventListener("click",this._adjustValue),this.plusButton&&this.plusButton.removeEventListener("click",this._adjustValue)}static initAll(selector,buildOptions){const elements=document.querySelectorAll(selector),controls=[];return elements.forEach(element=>{const options=buildOptions(element),control=new ParamSlider(element.id,options);controls.push(control)}),controls}}"undefined"!=typeof module&&module.exports&&(module.exports={ParamSlider:ParamSlider});